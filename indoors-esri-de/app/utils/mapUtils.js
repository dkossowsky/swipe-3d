define(["require","exports","../context/Context","esri/geometry/Extent","esri/geometry/Point","esri/Graphic","esri/layers/GraphicsLayer","esri/symbols/PictureMarkerSymbol","esri/geometry/SpatialReference","esri/geometry/geometryEngine","esri/core/promiseUtils","esri/geometry/support/webMercatorUtils"],function(e,t,g,y,a,m,s,p,l,d,u,c){"use strict";function v(e,t){var r,i,n;return"polygon"===t.type||t.hasOwnProperty("rings")?(r=t.extent.center.x,i=t.extent.center.y,t.hasZ&&(n=t.extent.center.z)):(r=t.x,i=t.y,t.hasZ&&(n=t.z)),new a({x:r,y:i,z:n,spatialReference:t.spatialReference})}function h(e,t,r,i,n){var o=g.default.getInstance().config.graphicElevationOffset,a=new m({geometry:t,symbol:r}),l=e.map.findLayerById(i);return l||((l=new s({id:i,listMode:"hide",title:n})).elevationInfo={mode:"relative-to-ground",offset:o,unit:"meters"},e.map.add(l)),l.graphics.removeAll(),l.graphics.add(a),l}function f(e,t){var r=function(e,t){return new y({xmin:e.xmin,xmax:e.xmax,ymin:e.ymin,ymax:e.ymax,zmin:t,zmax:t,spatialReference:e.spatialReference})};if(!t||!t.geometry)return u.resolve();var i,n=e&&"3d"===e.type,o=null,a=null,l=null,s=null;if("point"===t.geometry.type){if((o=d.geodesicBuffer(t.geometry,10,"meters"))&&o.extent){o=o.extent;var c="number"==typeof t.geometry.z?t.geometry.z:0;a={target:o=r(o.extent,c)}}}else if(t.geometry.extent){var f=t.geometry.extent.clone();if((o=d.geodesicBuffer(f,10,"meters"))&&o.extent){o=o.extent;c="number"==typeof f.zmin?f.zmin:0;a={target:o=r(o.extent,c)}}}else o=t.geometry,a={target:t};return i={duration:1e3,easing:"out-back"},n&&(e.camera&&(l=e.camera.heading,s=60),"number"==typeof l&&(a.heading=l),"number"==typeof s&&(a.tilt=s)),a?e.goTo(a,i).then(function(){n||e.extent.contains(o)||(e.zoom-=1)}):u.resolve()}Object.defineProperty(t,"__esModule",{value:!0}),t.afterSetLevel=function(e){var t=function(e){return!(!e||0!==e.locationType)};if(e&&"2d"===e.type){var r=e.map.findLayerById("indoors-location-graphics2");if(!r)return;var i=r&&r.xtnInfo;if(i&&0===i.locationType)return void(r.visible=!0);var n=i&&i.facilityId;if(!("string"==typeof n&&0<n.length))return!0;var o=g.default.getInstance().aiim.facilityMode.activeFacilityInfo;if(o)if(o.facilityId===n){var a=void 0;o.activeLevel?a=o.activeLevel.levelNumber:o.zeroVOLevel&&(a=o.zeroVOLevel.levelNumber),"number"==typeof a&&"number"==typeof i.levelNumber?r.visible=a===i.levelNumber:(i.levelNumber,r.visible=!0)}else r.visible=t(i);else r.visible=t(i)}},t.addLocationGraphic=function(e,t){e&&h(e,v(0,t),new p({width:23,height:23,yoffset:12,url:"data:image/svg+xml;base64,"+btoa('<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 512 512" width="512" height="512"><g><g><path d="M256,0C153.755,0,70.573,83.182,70.573,185.426c0,126.888,165.939,313.167,173.004,321.035    c6.636,7.391,18.222,7.378,24.846,0c7.065-7.868,173.004-194.147,173.004-321.035C441.425,83.182,358.244,0,256,0z M256,278.719 c-51.442,0-93.292-41.851-93.292-93.293S204.559,92.134,256,92.134s93.291,41.851,93.291,93.293S307.441,278.719,256,278.719z" fill="#FF3F00"/></g></g></svg>')}),"indoors-location-graphics","indoorsLocationGraphics")},t.addYouAreHereGraphic=function(e,t,r){if(e){var i=g.default.getInstance().i18n,n="indoors-location-graphics2",o="indoorsLocationGraphics2",a=v(0,t);if("2d"===e.type){var l=new p({width:36,height:36,url:"data:image/svg+xml;base64,"+btoa('<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32" class="svg-icon"><path d="M16.043.367L19.813 12H32l-9.859 7.172 3.789 11.625-9.887-7.193-9.889 7.193 3.787-11.625L0 12h12.271z" fill="#005e95"/></svg>')}),s={type:"text",text:i.map.youAreHere,color:"#005e95",haloColor:"#ffffff",haloSize:1,xoffset:0,yoffset:22,font:{size:16,family:"sans-serif",weight:"bold"}};(c=h(e,a,l,n,o)).xtnInfo=r,c.graphics.add(new m({geometry:a,symbol:s})),c.visible=!0}else if("3d"===e.type){l=new p({width:36,height:36,url:"data:image/svg+xml;base64,"+btoa('<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32" class="svg-icon"><path d="M16.043.367L19.813 12H32l-9.859 7.172 3.789 11.625-9.887-7.193-9.889 7.193 3.787-11.625L0 12h12.271z" fill="#005e95"/></svg>')});var c,f={type:"point-3d",symbolLayers:[{type:"text",text:i.map.youAreHere,material:{color:"#005e95"},halo:{color:[255,255,255,.7],size:2},size:16,font:{size:16,family:"sans-serif",weight:"bold"}}],verticalOffset:{screenLength:40,maxWorldLength:100,minWorldLength:10},callout:{type:"line",size:.5,color:[0,0,0],border:{color:[255,255,255,.7]}}};(c=h(e,a,l,n,o)).graphics.add(new m({geometry:a,symbol:f}))}}},t.clearLocationGraphic=function(e){if(e){var t=e.map.findLayerById("indoors-location-graphics");t&&t.graphics.removeAll()}},t.getGeometryValues=function(e){var t=null,r=null,i=null,n=null,o=null;return e&&e.spatialReference&&(("polygon"===(o=e.spatialReference.isWebMercator?c.webMercatorToGeographic(e):e).type||"polyline"===o.type)&&o.extent&&o.extent.center?(t=o.extent.center.x,r=o.extent.center.y,i=o.extent.center.z):"point"===o.type&&(t=o.x,r=o.y,i=o.z),null!==t&&null!=r&&(n=r+","+t)),{x:t,y:r,z:i,center:n}},t.goToFeature=f,t.goToXYLocation=function(e,t,r,i){var n=new a({x:t,y:r,spatialReference:l.WGS84}),o=c.geographicToWebMercator(n);return f(e,new m({geometry:o,symbol:null}))},t.reorderLocationGraphicLayers=function(){try{var e=function(e){if(e){var t=e.map.findLayerById("indoors-location-graphics");if(t){var r=e.map.layers.length;e.map.reorder(t,r)}}},t=g.default.getInstance().views;e(t.mapView),e(t.sceneView)}catch(e){console.warn("Error reordering layers."),console.error(e)}}});