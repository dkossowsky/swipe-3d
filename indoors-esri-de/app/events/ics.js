define(["require","exports","esri/core/promiseUtils","dojo/date/stamp"],function(e,n,t,f){"use strict";function p(){return(Date.now()+""+(""+Math.random()).replace("0.","r")).replace(/-/g,"")}Object.defineProperty(n,"__esModule",{value:!0}),n.generateRandomId=p,n.makeIcsInfo=function(l){return t.create(function(n,t){try{var r={blob:null,data:null,href:null,filename:"event.ics"},e=r.data=function(e){var n=function(e){return"string"!=typeof e?"":e},t=function(e){if(null==e)return null;"number"==typeof e&&(e=new Date(e));var n=f.toISOString(e,{zulu:!0});return n=n.replace(/-/g,"").replace(/:/g,"")},r=""+p(),a=n(e.name),o=n(e.description),l=n(e.location),u=n(e.geo),i=t(new Date),c=t(e.date_start),s=t(e.date_end);if(0===a.length||!c)return null;var d=["BEGIN:VCALENDAR","PRODID:ArcGIS Indoors","VERSION:2.0","BEGIN:VEVENT","UID:"+r,"DTSTAMP:"+i];return c&&d.push("DTSTART:"+c),s&&d.push("DTEND:"+s),0<a.length&&d.push("SUMMARY:"+a),0<l.length&&d.push("LOCATION:"+l),0<u.length&&d.push("GEO:"+u),0<o.length&&d.push("DESCRIPTION:"+o),(d=d.concat(["END:VEVENT","END:VCALENDAR"])).join("\n")}(l);if(e&&FileReader&&Blob){var a=r.blob=new Blob([e],{type:"text/calendar"}),o=new FileReader;o.onload=function(e){r.href=e.target.result,n(r)},o.onerror=function(e){t(e)},o.readAsDataURL(a)}else n(r)}catch(e){t(e)}})}});