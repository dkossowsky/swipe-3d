var __extends=this&&this.__extends||function(){var i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var s in t)t.hasOwnProperty(s)&&(e[s]=t[s])};return function(e,t){function s(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(s.prototype=t.prototype,new s)}}(),__decorate=this&&this.__decorate||function(e,t,s,i){var n,o=arguments.length,a=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,s):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,s,i);else for(var r=e.length-1;0<=r;r--)(n=e[r])&&(a=(o<3?n(a):3<o?n(t,s,a):n(t,s))||a);return 3<o&&a&&Object.defineProperty(t,s,a),a};define(["require","exports","esri/core/tsSupport/declareExtendsHelper","esri/core/tsSupport/decorateHelper","../context/Context","./Carousel","../infopanel/FeatureContent","../infopanel/ShareLocation","./ics","esri/core/accessorSupport/decorators","esri/widgets/support/widget","esri/core/promiseUtils"],function(e,t,i,n,l,o,s,d,a,r,f,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var p="i-eventdetails",u="i-header-text",h="i-section__left",v="i-section__right",x="i-section__line",g="i-section__timeperiod i-section__nowrap",y="i-section__calendar i-section__nowrap",_="i-section__location i-section__nowrap",I="i-section__details",b="i-group-caption",k="i-group-content",m="i-actionbar",w="i-actionbar-button",T="i-actionbar-button-caption",D="svg-icon i-icon-timeperiod",O="svg-icon i-icon-calendar",C="svg-icon i-icon-location",j=function(s){function e(e){var t=s.call(this,e)||this;return t._eventDetailsWasInitialized=!1,t._mailToUpdated=!1,t.carousel=new o.default,t}return i(e,s),e.prototype._eventDetailsInit=function(){var t=this;this._eventDetailsWasInitialized=!0;var s=l.default.getInstance().isKiosk,e=l.default.getInstance().aiim.datasets.events,i=this.getFeature();if(e&&i){this.eventInfo=e.getEventInfo({forDetails:!0},i),this.carousel.eventInfo=this.eventInfo;var n=[];n[0]=a.makeIcsInfo(this.eventInfo).then(function(e){s||(t.icsInfo=e)}).catch(function(e){console.error("Error generating event .ics file:",e)}),n[1]=e.loadAttachments(this.eventInfo).then(function(e){}).catch(function(e){console.error("Error loading attachments:",e)}),c.eachAlways(n).then(function(e){t.scheduleRender()})}},e.prototype.render=function(){var e=l.default.getInstance().i18n;return this.hasGeometry?(this._eventDetailsWasInitialized||this._eventDetailsInit(),this.eventInfo?f.tsx("div",{key:"i-eventdetails",class:p},this.carousel.render(),this.renderHeaderText(),this.renderActions(),this.renderDetails()):null):f.tsx("div",{key:"i-eventdetails",class:"i-padded"},f.tsx("p",null,e.infoPanel.messages.noGeometry))},e.prototype.renderActions=function(){var e=this,t=l.default.getInstance().i18n,s=this.searchResult,i="libs/calcite-ui-icons/icons/sprite-16.svg#",n=(l.default.getInstance().session.referenceLayer,i+"calendar-16-f"),o=null,a=null,r=null;if(s&&s.feature&&s.feature.geometry){if(this.icsInfo&&"string"==typeof this.icsInfo.href&&(o=window.navigator&&window.navigator.msSaveOrOpenBlob?f.tsx("li",{key:"addToCalendar"},f.tsx("a",{class:w,role:"button",href:"#",onclick:function(){window.navigator.msSaveOrOpenBlob(e.icsInfo.blob,e.icsInfo.filename)}},f.tsx("svg",{class:"svg-icon"},f.tsx("use",{href:n})),f.tsx("span",{class:T},t.events.details.addToCalendar))):f.tsx("li",{key:"addToCalendar"},f.tsx("a",{class:w,role:"button",download:this.icsInfo.filename,target:"_blank",href:this.icsInfo.href},f.tsx("svg",{class:"svg-icon"},f.tsx("use",{href:n})),f.tsx("span",{class:T},t.events.details.addToCalendar)))),a=f.tsx("li",{key:"directions"},f.tsx("a",{bind:this,class:w,role:"button",href:"javascript:void(0)",onclick:this.directionsClicked},f.tsx("svg",{class:"svg-icon"},f.tsx("use",{href:"libs/calcite-ui-icons/icons/sprite-16.svg#right-16-f"})),f.tsx("span",{class:T},t.directions.caption))),this.mailTo&&!this._mailToUpdated){var c=new d.default;this.mailTo=this.shareDropdown.mailTo=c.generateMailtoToURL(this.getSource(),this.sourceKey,this.searchResult,this.eventInfo),this._mailToUpdated=!0}this.mailTo&&(r=this.shareDropdown.renderActions())}return f.tsx("ul",{class:m},a,r,o)},e.prototype.renderDetails=function(){var e=l.default.getInstance().i18n,t=this.eventInfo;return f.tsx("div",{key:"details",class:I},f.tsx("div",{key:"d-caption",class:b},e.events.details.caption),f.tsx("div",{key:"d-desc",class:k},t.description))},e.prototype.renderHeaderText=function(){var e=this.eventInfo,t=f.tsx("div",{key:"h-tp",class:g},f.tsx("div",{class:h},f.tsx("svg",{key:"h-tp1",class:D},f.tsx("use",{href:"libs/calcite-ui-icons/icons/sprite-16.svg#clock-16-f"}))),f.tsx("div",{class:v},f.tsx("span",{key:"h-tp2",class:x},e.timePeriod))),s=f.tsx("div",{key:"h-dt",class:y},f.tsx("div",{class:h},f.tsx("svg",{key:"h-dt1",class:O},f.tsx("use",{href:"libs/calcite-ui-icons/icons/sprite-16.svg#calendar-16-f"}))),f.tsx("div",{class:v},f.tsx("span",{key:"h-dt2",class:x},e.longDate))),i=f.tsx("div",{key:"h-loc",class:_},f.tsx("div",{class:h},f.tsx("svg",{key:"h-loc1",class:C},f.tsx("use",{href:"libs/calcite-ui-icons/icons/sprite-16.svg#pin-16-f"}))),f.tsx("div",{class:v},f.tsx("span",{key:"h-loc2",class:x},e.location)));return f.tsx("div",{key:"h-text",class:u},t,s,i)},n([r.property()],e.prototype,"carousel",void 0),n([r.property()],e.prototype,"eventInfo",void 0),n([r.property()],e.prototype,"icsInfo",void 0),e=n([r.subclass("app.events.EventDetails")],e)}(r.declared(s.default));t.default=j});