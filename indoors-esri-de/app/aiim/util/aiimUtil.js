define(["require","exports","../../context/Context","esri/identity/IdentityManager","esri/request"],function(e,n,t,r,o){"use strict";function a(e,n){var t=null;if(e&&0<e.length){var r=n.toLowerCase();e.some(function(e){if(r===e.name.toLowerCase())return t=e,!0})}return t}Object.defineProperty(n,"__esModule",{value:!0}),n.appendTokenToUrl=function(e){if(e&&-1===e.indexOf("token=")){var n=null,t=r.findCredential(e);t&&(n=t.token),n&&(-1===e.indexOf("?")?e+="?":e+="&",e+="token="+encodeURIComponent(n))}return e},n.findAttributeName=function(e,n){if(!e)return null;if(e.hasOwnProperty(n))return n;var t=null,r=n.toLowerCase();return Object.keys(e).some(function(e){if(e.toLowerCase()===r)return t=e,!0}),t},n.findField=a,n.findFieldName=function(e,n){var t=a(e,n);return t?t.name:null},n.getAttributeValue=function(n,e){if(n&&"string"==typeof e){if(n.hasOwnProperty(e))return n[e];var t,r=e.toLowerCase();return Object.keys(n).some(function(e){if(e.toLowerCase()===r)return t=n[e],!0}),t}},n.getLayers=function(e){return e?e.map.layers.flatten(function(e){return e.layers||e.sublayers}):[]},n.readServiceJson=function(e){return e=t.default.checkMixedContent(e),o(e,{query:{f:"json"},responseType:"json"})},n.removeShapeAttributes=function(n){if(n){var t=[];Object.keys(n).forEach(function(e){var n=e.toLowerCase();"shape_area"!==n&&"shape_length"!==n&&"shape_len"!==n&&"shape.area"!==n&&"shape.length"!==n&&"shape.len"!==n&&"shape.starea()"!==n&&"shape.stlength()"!==n||t.push(e)}),t.forEach(function(e){delete n[e]})}}});