var __extends=this&&this.__extends||function(){var i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}}(),__decorate=this&&this.__decorate||function(e,t,r,i){var a,l=arguments.length,o=l<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,i);else for(var u=e.length-1;0<=u;u--)(a=e[u])&&(o=(l<3?a(o):3<l?a(t,r,o):a(t,r))||o);return 3<l&&o&&Object.defineProperty(t,r,o),o};define(["require","exports","esri/core/tsSupport/declareExtendsHelper","esri/core/tsSupport/decorateHelper","esri/core/tsSupport/assignHelper","../../context/Context","./Dataset","./FieldNames","../util/aiimUtil","esri/core/accessorSupport/decorators","esri/tasks/support/Query","esri/tasks/QueryTask","esri/core/promiseUtils"],function(e,t,i,a,r,l,o,u,f,n,v,h,m){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=function(r){function e(e){var t=r.call(this,e)||this;return t.facilityIdField=u.default.FACILITY_ID,t.facilityNameField=u.default.FACILITY_NAME,t.levelNumberField=u.default.LEVEL_NUMBER,t.shortNameField=u.default.NAME_SHORT,t.type="feature",t.verticalOrderField=u.default.VERTICAL_ORDER,t.data=null,t.requiresFacilityMode=!0,t}return i(e,r),e.prototype.checkSchema=function(){var i=this;return m.create(function(e,t){if(i.layer2D){var r=i.layer2D;r.when(function(){i.checkFieldNameProperty("facilityIdField",r.fields),i.checkFieldNameProperty("facilityNameField",r.fields),i.checkFieldNameProperty("levelNumberField",r.fields),i.checkFieldNameProperty("shortNameField",r.fields),i.checkFieldNameProperty("verticalOrderField",r.fields),i.data||i.queryAll(),e()})}else e()})},e.prototype.getFacilityData=function(e){var t=this;if("string"!=typeof e||0===e.length)return m.resolve(null);var r=function(){return t.data&&t.data.dataByFacility?t.data.dataByFacility[e]:null};return this.data?m.resolve(r()):this.queryAll().then(function(){return t.data?m.resolve(r()):null})},e.prototype.getFacilityLevels=function(t){var r=this;if("string"!=typeof t||0===t.length)return m.resolve(null);var e=function(){if(r.data&&r.data.dataByFacility){var e=r.data.dataByFacility[t];if(e&&e.levels)return e.levels}return null};return this.data?m.resolve(e()):this.queryAll().then(function(){return r.data?m.resolve(e()):null})},e.prototype.getShortNameIfLoaded=function(e,t){if(this.data&&this.data.dataByFacility){var r=this.data.dataByFacility[e];if(r&&r.shortNamesByLevelNumber)return r.shortNamesByLevelNumber[t]}return"number"==typeof t?""+t:""},e.prototype.getZeroVOLevel=function(t){return t?(t.zeroVOLevel||t.levels.some(function(e){return 0===e.verticalOrder&&("number"==typeof e.levelNumber&&(t.zeroVOLevel=e),!0)}),t.zeroVOLevel):null},e.prototype.queryAll=function(){var r=this;if(this.data)return m.resolve(this.data);var n={},s=this.facilityIdField,c=this.facilityNameField,d=this.levelNumberField,y=this.shortNameField,p=this.verticalOrderField,e=l.default.checkMixedContent(this.url),t=new h({url:e}),i=new v;return i.outFields=["*"],i.orderByFields=[p],i.returnGeometry=!1,i.returnZ=!1,i.where="1=1",t.execute(i).then(function(e){e&&e.features&&e.features.forEach(function(e){if(e&&e.attributes){var t=f.getAttributeValue(e.attributes,s),r=f.getAttributeValue(e.attributes,c),i=f.getAttributeValue(e.attributes,d),a=f.getAttributeValue(e.attributes,y),l=f.getAttributeValue(e.attributes,p);if("string"==typeof t&&0<t.length){var o=void 0;n.hasOwnProperty(t)?o=n[t]:(o={facilityId:t,facilityName:r,levels:[],shortNamesByLevelNumber:{},levelNumbersByVO:{}},n[t]=o);var u={levelNumber:i,levelShortName:a,verticalOrder:l};o.levels.push(u),o.shortNamesByLevelNumber[i]=a,o.levelNumbersByVO[l]=i}}});var t={dataByFacility:n};return r.data||(r.data=t),t}).catch(function(e){return console.log("Error querying all levels:"),console.error(e),m.reject(e)})},a([n.property()],e.prototype,"facilityIdField",void 0),a([n.property()],e.prototype,"facilityNameField",void 0),a([n.property()],e.prototype,"levelNumberField",void 0),a([n.property()],e.prototype,"shortNameField",void 0),a([n.property()],e.prototype,"type",void 0),a([n.property()],e.prototype,"verticalOrderField",void 0),e=a([n.subclass("app.aiim.datasets.Levels")],e)}(n.declared(o.default));t.default=s});