var __extends=this&&this.__extends||function(){var i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}}(),__decorate=this&&this.__decorate||function(e,t,r,i){var o,n=arguments.length,a=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,i);else for(var u=e.length-1;0<=u;u--)(o=e[u])&&(a=(n<3?o(a):3<n?o(t,r,a):o(t,r))||a);return 3<n&&a&&Object.defineProperty(t,r,a),a};define(["require","exports","esri/core/tsSupport/declareExtendsHelper","esri/core/tsSupport/decorateHelper","esri/core/tsSupport/assignHelper","../../context/Context","./Dataset","./FieldNames","../util/aiimUtil","esri/core/accessorSupport/decorators","esri/tasks/support/Query","esri/tasks/QueryTask","esri/core/promiseUtils"],function(e,t,i,o,r,n,a,u,l,s,c,d,p){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var f=function(r){function e(e){var t=r.call(this,e)||this;return t.facilityIdField=u.default.FACILITY_ID,t.nameField=u.default.NAME,t.nameLongField=u.default.NAME_LONG,t}return i(e,r),e.prototype.checkSchema=function(){var i=this;return p.create(function(e,t){if(i.layer2D){var r=i.layer2D;r.when(function(){i.checkFieldNameProperty("facilityIdField",r.fields),i.checkFieldNameProperty("nameField",r.fields),i.checkFieldNameProperty("nameLongField",r.fields),e()})}else e()})},e.prototype.getFacilityIdField=function(e,t){return l.findField(t,u.default.FACILITY_ID)},e.prototype.getLabelText=function(e){var t;return this.layer2D&&this.layer2D.displayField&&(t=l.getAttributeValue(e.attributes,this.layer2D.displayField)),"string"==typeof t&&0!==t.length||(t=l.getAttributeValue(e.attributes,this.nameLongField)),"string"==typeof t&&0!==t.length||(t=l.getAttributeValue(e.attributes,this.nameField)),t},e.prototype.getSource=function(){return n.default.getInstance().aiim.datasets.categories.findSourceByKey("Facilities")},e.prototype.isVisibleAtScale2D=function(e){var t=this.layer2D;if(this.subLayer&&(t=this.subLayer),t&&e){var r=e.get("scale"),i=0===t.minScale||r<=t.minScale,o=0===t.maxScale||r>=t.maxScale;return t.visible&&i&&o}return!1},e.prototype.queryAll=function(){if(!this.url)return p.resolve();var e=n.default.checkMixedContent(this.url),t=new d({url:e}),r=new c;return r.outFields=["*"],r.returnGeometry=!0,r.returnZ=!0,r.where="1=1",t.execute(r)},e.prototype.queryByGeometry=function(e,t){if(!this.url)return p.resolve();var r=n.default.checkMixedContent(this.url),i=new d({url:r}),o=new c;return o.outFields=["*"],o.returnGeometry=!0,o.returnZ=!0,o.where="1=1",o.geometry=e,"number"==typeof t&&0<t&&(o.distance=t,o.units="meters"),i.execute(o)},e.prototype.queryFacilityIdsByGeometry=function(e,t){return this.queryByGeometry(e,t).then(function(e){if(e&&e.features){var r=l.findField(e.fields,u.default.FACILITY_ID);if(r){var i=[];return e.features.forEach(function(e){var t=l.getAttributeValue(e.attributes,r.name);i.push(t)}),i}}return null})},o([s.property()],e.prototype,"facilityIdField",void 0),o([s.property()],e.prototype,"nameField",void 0),o([s.property()],e.prototype,"nameLongField",void 0),e=o([s.subclass("app.aiim.datasets.Facilities")],e)}(s.declared(a.default));t.default=f});