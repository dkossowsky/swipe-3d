var __extends=this&&this.__extends||function(){var s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(e,t){function r(){this.constructor=e}s(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}}(),__decorate=this&&this.__decorate||function(e,t,r,s){var i,o=arguments.length,n=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,r):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,r,s);else for(var u=e.length-1;0<=u;u--)(i=e[u])&&(n=(o<3?i(n):3<o?i(t,r,n):i(t,r))||n);return 3<o&&n&&Object.defineProperty(t,r,n),n};define(["require","exports","esri/core/tsSupport/declareExtendsHelper","esri/core/tsSupport/decorateHelper","../aiim/base/RelatedItems","../aiim/base/SubTypeIcon","../context/Topic","esri/widgets/Widget","esri/core/accessorSupport/decorators","esri/widgets/support/widget"],function(e,t,s,i,o,l,p,r,n,f){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var u="i-feature-items",d="i-feature-item-text",h="i-feature-item-title",y="i-feature-item-subtitle",a="i-icon-working",c=function(r){function e(e){var t=r.call(this,e)||this;return t.results=[],t._activePromise=null,t._wasQueried=!1,t}return s(e,r),e.prototype.query=function(){var t=this;if(this._wasQueried=!0,!this._activePromise&&this.item&&this.item.isValid()){var e=new o.default;(this._activePromise=e.query(this.item)).then(function(e){t._activePromise=null,t.results=e,t.scheduleRender()}).catch(function(e){t._activePromise=null,t.results=null,t.scheduleRender(),console.warn("Error querying related items:"),console.error(e)})}},e.prototype.render=function(){var t=this;this._wasQueried||this.query();var r="i-infopanel-relateditems";if(this._activePromise)return f.tsx("div",{key:"workingIcon",class:a});var s=[];if(this.results&&0<this.results.length){var i=-1;this.results.forEach(function(e){i++,s.push(t.renderResult(e,r+"-"+i))})}return f.tsx("ul",{key:r,class:u},s)},e.prototype.renderItem=function(e,t,r){var s,i=t.getTitle(),o=t.getSubTitle();s=new l.default({forFeature:!0,source:e,subType:t.subType}).render();var n=r+"_span1",u=r+"_span2",a=r+"_span3",c=null;return o&&(c=f.tsx("span",{key:a,class:y},o)),f.tsx("li",{key:r},f.tsx("a",{href:"#",onclick:function(){p.default.publish(p.default.ShowSearchResult,{sourceKey:t.sourceKey,searchResult:t.searchResult,zoom:!0,highlight:!0,trackRecent:!0})}},s,f.tsx("span",{key:n,class:d},f.tsx("span",{key:u,class:h},i),c),null))},e.prototype.renderResult=function(e,r){var s=this,i=e.source,o=(e.items,[]);if(e.items&&0<e.items.length){var n=-1;e.items.forEach(function(e){n++;var t=s.renderItem(i,e,r+"-"+n);t&&o.push(t)})}return o},i([n.property()],e.prototype,"item",void 0),i([n.property()],e.prototype,"results",void 0),e=i([n.subclass("app.infopanel.Related")],e)}(n.declared(r));t.default=c});