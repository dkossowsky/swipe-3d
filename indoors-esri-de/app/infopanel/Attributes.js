var __extends=this&&this.__extends||function(){var i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}}(),__decorate=this&&this.__decorate||function(e,t,r,i){var a,p=arguments.length,o=p<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,i);else for(var s=e.length-1;0<=s;s--)(a=e[s])&&(o=(p<3?a(o):3<p?a(t,r,o):a(t,r))||o);return 3<p&&o&&Object.defineProperty(t,r,o),o};define(["require","exports","esri/core/tsSupport/declareExtendsHelper","esri/core/tsSupport/decorateHelper","../context/Context","esri/widgets/Widget","esri/core/accessorSupport/decorators","esri/Graphic","esri/widgets/Feature","esri/PopupTemplate"],function(e,t,r,i,a,p,o,s,n,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var u=function(t){function e(e){return t.call(this,e)||this}return r(e,t),e.prototype.postInitialize=function(){this.item;var e=this.getFeature(),t=this.getLayer();if(!this._featureWidget&&e&&t){var r=new s({attributes:e.attributes,geometry:e.geometry,popupTemplate:e.popupTemplate,layer:t});r.popupTemplate||(r.popupTemplate=this.getPopupTemplate()),this._featureWidget=new n({graphic:r,view:a.default.getInstance().views.activeView}),this._featureWidget._shouldOpenInNewTab=function(e){return!1},this._featureWidget.viewModel.set("graphic",r)}},e.prototype.getDefaultFieldInfo=function(e){var t=e.name,r={fieldName:t,label:e.alias||t,tooltip:"",visible:!1,format:null,stringFieldOption:"text-box"};switch(e.type){case"esriFieldTypeSmallInteger":case"esriFieldTypeInteger":r.format={places:0,digitSeparator:!0};break;case"esriFieldTypeSingle":case"esriFieldTypeDouble":r.format={places:2,digitSeparator:!0};break;case"esriFieldTypeDate":r.format={dateFormat:"longMonthDayYear"}}return r},e.prototype.getFeature=function(){return this.feature||this.item&&this.item.isValid()&&(this.feature=this.item.getFeature()),this.feature},e.prototype.getLayer=function(){if(!this.layer){var e=this.getFeature();if(e&&e.layer)this.layer=e.layer;else if(this.item&&this.item.isValid()){var t=this.item.getSource();t&&t.layer2D&&(this.layer=t.layer2D)}}return this.layer},e.prototype.getPopupTemplate=function(){if(this.item&&this.item.isValid()){var e=this.item.getSource();if(e&&e.subLayer&&e.subLayer.popupTemplate)return e.subLayer.popupTemplate;if(e&&e.layer2D)return e.layer2D.popupTemplate?e.layer2D.popupTemplate:this.makePopupTemplate(e.layer2D)}else{var t=this.getFeature(),r=this.getLayer();if(t&&t.popupTemplate)return t.popupTemplate;if(r&&r.popupTemplate)return r.popupTemplate}return null},e.prototype.makePopupTemplate=function(e){var r=this;if(e&&e.fields){var i=[];e.fields.forEach(function(e){var t=r.getDefaultFieldInfo(e);t.visible=!0,i.push(t)});var t={title:e.title,content:[{type:"fields",fieldInfos:i},{type:"attachments"}]};return new l(t)}return null},e.prototype.render=function(){var e=null;return this._featureWidget&&(e=this._featureWidget.render()),e},i([o.property()],e.prototype,"feature",void 0),i([o.property()],e.prototype,"item",void 0),i([o.property()],e.prototype,"layer",void 0),e=i([o.subclass("app.infopanel.Attributes")],e)}(o.declared(p));t.default=u});