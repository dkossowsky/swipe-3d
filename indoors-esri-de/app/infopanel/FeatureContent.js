var __extends=this&&this.__extends||function(){var i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var s in t)t.hasOwnProperty(s)&&(e[s]=t[s])};return function(e,t){function s(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(s.prototype=t.prototype,new s)}}(),__decorate=this&&this.__decorate||function(e,t,s,i){var r,a=arguments.length,o=a<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,s):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,s,i);else for(var n=e.length-1;0<=n;n--)(r=e[n])&&(o=(a<3?r(o):3<a?r(t,s,o):r(t,s))||o);return 3<a&&o&&Object.defineProperty(t,s,o),o};define(["require","exports","esri/core/tsSupport/declareExtendsHelper","esri/core/tsSupport/decorateHelper","../context/Context","../context/Topic","./Content","./ShareLocation","./ShareDropdown","./Attributes","./Related","../aiim/base/ItemReference","esri/core/accessorSupport/decorators","esri/widgets/support/widget"],function(e,t,i,r,p,a,s,o,n,c,l,u,h,v){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var f="i-infopanel-content-feature",y="i-actionbar",g="i-actionbar-button",b="i-actionbar-button-caption",x="i-infopanel-hasfavorite",d="tab-nav",_="tab-title",m="is-active",R="i-infopanel-feature-tabcontent",T=function(s){function e(e){var t=s.call(this,e)||this;return t.activeTab="attributes",t.hasGeometry=!1,t._311Url=null,t.mailTo=null,t.shareDropdown=null,t}return i(e,s),e.prototype.postInitialize=function(){var e=p.default.getInstance().isKiosk,t=new u.default,s=this.searchResult,i=this.getSource();if(i&&s&&s.feature)try{this.hasGeometry=!!s.feature.geometry;var r=i.getTitle(s.feature);void 0!==r&&null!=r&&(this.caption=r),t.fromSearchResult(this.sourceKey,this.searchResult),e||(this._311Url=this.generate311Url())}catch(e){console.warn("Error initializing InfoPanel:"),console.error(e)}t&&t.isValid()&&(this._attributesWidget||(this._attributesWidget=new c.default({item:t})),this._relatedWidget||(this._relatedWidget=new l.default({item:t})));try{if(e||(this.mailTo=this.generateMailtoToURL()),this.mailTo){var a={sourceKey:this.sourceKey,searchResult:this.searchResult,mailTo:this.mailTo};this.shareDropdown=new n.default(a)}}catch(e){console.warn("Error generating mailto URL:"),console.error(e)}},e.prototype.directionsClicked=function(){a.default.publish(a.default.DirectionsClicked,{searchResult:this.searchResult})},e.prototype.generate311Url=function(){var e=null,t=this.getSource(),s=p.default.getInstance().aiim.datasets.indoorsConfig;if(t&&s.has311App()&&t.getFields()){var i=this.searchResult;e=s.get311Url(t,i.feature)}return e},e.prototype.getFeature=function(){return this.searchResult&&this.searchResult.feature},e.prototype.generateMailtoToURL=function(){var e=this.getSource();return(new o.default).generateMailtoToURL(e,this.sourceKey,this.searchResult)},e.prototype.getSource=function(){return p.default.getInstance().aiim.datasets.categories.findSourceByKey(this.sourceKey)},e.prototype.render=function(){var e=p.default.getInstance().i18n;if(!this.hasGeometry)return v.tsx("div",{key:"i-feature-content",class:"i-padded"},v.tsx("p",null,e.infoPanel.messages.noGeometry));var t=v.tsx("nav",{class:d,role:"tablist"},this.renderTab("attributes",e.infoPanel.tabs.attributes),this.renderTab("related",e.infoPanel.tabs.related)),s=null;return"attributes"===this.activeTab?s=this._attributesWidget.render():"related"===this.activeTab&&(s=this._relatedWidget.render()),v.tsx("div",{key:"i-feature-content",class:f},this.renderActions(),t,v.tsx("div",{key:"i-feature-tabcontent",class:R},s))},e.prototype.renderActions=function(){var e=p.default.getInstance().i18n,t=p.default.getInstance().isKiosk,s=this.searchResult,i=p.default.getInstance().session.referenceLayer,r=null,a=null,o=null,n=null,c=null;if(s&&s.feature&&s.feature.geometry){r=v.tsx("li",{key:"directions"},v.tsx("a",{bind:this,class:g,role:"button",href:"javascript:void(0)",onclick:this.directionsClicked},v.tsx("svg",{class:"svg-icon"},v.tsx("use",{href:"libs/calcite-ui-icons/icons/sprite-16.svg#right-16-f"}," ")),v.tsx("span",{class:b},e.directions.caption))),a=v.tsx("li",{key:"home"},v.tsx("a",{bind:this,class:g,role:"button",href:"javascript:void(0)",onclick:this.setHomeLocation},v.tsx("svg",{class:"svg-icon"},v.tsx("use",{href:"libs/calcite-ui-icons/icons/sprite-16.svg#home-16-f"})),v.tsx("span",{class:b},e.infoPanel.actions.setHome)));var l=i.hasFavorite(this.sourceKey,this.searchResult),u=l?g+" "+x:g,h=l?e.infoPanel.actions.tipAlreadySaved:"",f=l?e.infoPanel.actions.savedFavorite:e.infoPanel.actions.saveFavorite;if(t||(o=v.tsx("li",{key:"favorite"},v.tsx("a",{bind:this,class:u,title:h,role:"button",href:"javascript:void(0)",onclick:this.saveFavorite},v.tsx("svg",{class:"svg-icon"},v.tsx("use",{href:"libs/calcite-ui-icons/icons/sprite-16.svg#star-16-f"})),v.tsx("span",{class:b},f)))),this._311Url){var d=this._311Url;n=v.tsx("li",{key:"311"},v.tsx("a",{class:g,href:d,target:"_blank",role:"button"},v.tsx("svg",{class:"svg-icon"},v.tsx("use",{href:"libs/calcite-ui-icons/icons/sprite-16.svg#bell-16-f"})),v.tsx("span",{class:b},e.infoPanel.actions.launch311)))}this.mailTo&&(c=this.shareDropdown.renderActions())}return v.tsx("ul",{class:y},r,a,o,n,c)},e.prototype.renderTab=function(e,t){var s,i=this,r=((s={})[m]=this.activeTab===e,s);return v.tsx("a",{href:"#",class:_,classes:r,bind:this,onclick:function(){i.activeTab=e},role:"tab"},t)},e.prototype.saveFavorite=function(){p.default.getInstance().session.referenceLayer.addFavorite(this.sourceKey,this.searchResult)},e.prototype.saveRecent=function(){p.default.getInstance().session.referenceLayer.addRecent(this.sourceKey,this.searchResult)},e.prototype.setHomeLocation=function(){p.default.getInstance().session.referenceLayer.setHomeLocation(this.sourceKey,this.searchResult)},r([h.property()],e.prototype,"activeTab",void 0),r([h.property()],e.prototype,"hasGeometry",void 0),r([h.property()],e.prototype,"searchResult",void 0),r([h.property()],e.prototype,"sourceKey",void 0),e=r([h.subclass("app.infopanel.FeatureContent")],e)}(h.declared(s.default));t.default=T});