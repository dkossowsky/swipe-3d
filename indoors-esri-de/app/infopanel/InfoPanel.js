var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(e,t){function i(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}}(),__decorate=this&&this.__decorate||function(e,t,i,n){var o,s=arguments.length,a=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,n);else for(var c=e.length-1;0<=c;c--)(o=e[c])&&(a=(s<3?o(a):3<s?o(t,i,a):o(t,i))||a);return 3<s&&a&&Object.defineProperty(t,i,a),a};define(["require","exports","esri/core/tsSupport/declareExtendsHelper","esri/core/tsSupport/decorateHelper","../context/Context","../context/Topic","../common//Icons","../events/EventDetails","./FeatureContent","./NonAiimFeature","../aiim/util/hitTest","../utils/mapUtils","esri/widgets/Widget","esri/core/accessorSupport/decorators","esri/widgets/support/widget"],function(e,t,i,n,g,l,k,o,s,a,c,d,r,h,y){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var v="i-infopanel i-infopanel-shown",x="i-panel-header",b="i-panel-header-tools",m="i-button-expand i-icon-button",w="i-button-close i-icon-button",R="i-expanded",u="i-infopanel-open",S="i-infopanel i-infopanel-hidden",I="i-infopanel-content",P="i-infopanel-backnext",_="disabled",p=function(t){function e(e){var n=t.call(this)||this;n.hidden=!0,n.stack=[],n.stackPosition=-1;var i=g.default.getInstance();return n.own(l.default.subscribe(l.default.DirectionsClicked,function(e){if(!n.hidden){var t=g.default.getInstance().uiMode;(t.modeIsHorizontalSplit()||t.modeIsVerticalSplit())&&n.hide()}})),n.own(l.default.subscribe(l.default.ShowSearchResult,function(e){n.showSearchResult(e)})),n.own(l.default.subscribe(l.default.ViewClicked,function(e){var t=i.config.allowNonAiimIdentify;c.search(e.view,e.event,t).then(function(e){if(e&&0<e.length){var t=e[0],i=!(!t.source||!t.source.isAiimFacilities());n.showSearchResult({sourceKey:t.sourceKey,searchResult:t.searchResult,isNonAiimFeature:!!t.isNonAiimFeature,zoom:i,highlight:!0,trackRecent:!0})}}).catch(function(e){console.log("Mapclick error:"),console.error(e)})})),n}return i(e,t),e.prototype.hide=function(){this.hidden=!0;var e=g.default.getInstance().views.activeView,t=g.default.getInstance().views.getInactiveView();d.clearLocationGraphic(e),t&&d.clearLocationGraphic(t)},e.prototype.render=function(){if(this.updateBodyClass(!this.hidden),this.hidden)return null;var e=g.default.getInstance().i18n,t=null,i=null;this.content&&!this.hidden&&(i=this.content.render(),t=this.content.caption);var n,o,s,a=this.hidden?S:v,c=((n={})[_]=!this.stackCanStepBack(),n),r=((o={})[_]=!this.stackCanStepNext(),o),l=this.hidden?"-1":"0",d=""+this.hidden,h=g.default.getInstance().uiMode.expanded,u=((s={})[R]=h,s),p=h?k.default.panelCollapse():k.default.panelExpand(),f=h?e.general.collapse:e.general.expand;return y.tsx("div",{key:"i-infopanel",class:a,classes:u,role:"complementary","aria-hidden":d},y.tsx("header",{key:"header-k1",class:x},y.tsx("h4",{key:"header-k2"},t),y.tsx("div",{key:"header-k3",class:b},y.tsx("a",{key:"header-k4",href:"#",class:m,role:"button",title:f,bind:this,onclick:this.toggleExpanded},p),y.tsx("a",{key:"header-k5",href:"#",class:w,role:"button",title:e.general.close,bind:this,onclick:this.hide},k.default.close()))),y.tsx("div",{class:I},i),y.tsx("div",{class:P},y.tsx("a",{href:"#",title:e.infoPanel.backTooltip,classes:c,role:"button",bind:this,onclick:this.stackStepBack,tabindex:l},y.tsx("svg",{class:"icon",style:"transform:rotateY(180deg);"},y.tsx("use",{href:"libs/calcite-ui-icons/icons/sprite-24.svg#arrow-24-f"})),e.general.back),y.tsx("a",{href:"#",title:e.infoPanel.nextTooltip,classes:r,role:"button",bind:this,onclick:this.stackStepNext,tabindex:l},e.general.next,y.tsx("svg",{class:"icon"},y.tsx("use",{href:"libs/calcite-ui-icons/icons/sprite-24.svg#arrow-24-f"})))))},e.prototype.showSearchResult=function(e){try{var t=void 0;t=e.isNonAiimFeature?this.content=new a.default({searchResult:e.searchResult}):"Events"===e.sourceKey?this.content=new o.default({sourceKey:e.sourceKey,searchResult:e.searchResult}):this.content=new s.default({sourceKey:e.sourceKey,searchResult:e.searchResult}),this.stackAdd(t),this.hidden?this.hidden=!1:this.scheduleRender(),this.zoomAndHighlight(this.content,e)}catch(e){console.warn("Error showing InfoPanel:"),console.error(e)}},e.prototype.stackAdd=function(e){var t=this.stack.length,i=this.stackPosition;i+1<t&&this.stack.splice(i+1),this.stack.push(e),this.stackPosition++},e.prototype.stackCanStepBack=function(){return 0<this.stackPosition},e.prototype.stackCanStepNext=function(){var e=this.stack.length,t=this.stackPosition;return 0<e&&t+1<e},e.prototype.stackStepBack=function(){this.stackCanStepBack()&&(this.stackPosition--,this.content=this.stack[this.stackPosition],this.zoomAndHighlight(this.content,{zoom:!0,highlight:!0,trackRecent:!0}))},e.prototype.stackStepNext=function(){this.stackCanStepNext()&&(this.stackPosition++,this.content=this.stack[this.stackPosition],this.zoomAndHighlight(this.content,{zoom:!0,highlight:!0,trackRecent:!0}))},e.prototype.toggleExpanded=function(){g.default.getInstance().uiMode.toggleExpanded()},e.prototype.updateBodyClass=function(e){var t=u;e?document.body.classList.add(t):document.body.classList.remove(t)},e.prototype.zoomAndHighlight=function(e,t){var i=e.searchResult.feature,n=i&&i.geometry&&!0,o=g.default.getInstance().views.activeView,s=o&&o.camera?o.camera.clone():null,a=o&&"2d"===o.type&&o.extent?o.extent.clone():null;if(!t.publishedFromLevelFilter){var c=e&&e.sourceKey&&g.default.getInstance().aiim.datasets.categories.findSourceByKey(e.sourceKey);l.default.publish(l.default.ItemOpened,{content:e,source:c,feature:i,lastCamera:s,lastExtent2D:a,view:o})}if(o&&t.zoom&&n&&d.goToFeature(o,i),o&&t.highlight){var r=g.default.getInstance().views.getInactiveView();n?(d.addLocationGraphic(o,i.geometry),r&&d.addLocationGraphic(r,i.geometry)):(d.clearLocationGraphic(o),r&&d.clearLocationGraphic(r))}t.trackRecent&&n&&"function"==typeof e.saveRecent&&e.saveRecent()},n([h.property()],e.prototype,"content",void 0),n([h.property(),y.renderable()],e.prototype,"hidden",void 0),n([h.property()],e.prototype,"stack",void 0),n([h.property()],e.prototype,"stackPosition",void 0),e=n([h.subclass("app.infopanel.InfoPanel")],e)}(h.declared(r));t.default=p});