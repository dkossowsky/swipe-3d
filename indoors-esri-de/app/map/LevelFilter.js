var __extends=this&&this.__extends||function(){var o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}}(),__decorate=this&&this.__decorate||function(t,e,i,o){var n,l=arguments.length,r=l<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;0<=s;s--)(n=t[s])&&(r=(l<3?n(r):3<l?n(e,i,r):n(e,i))||r);return 3<l&&r&&Object.defineProperty(e,i,r),r};define(["require","exports","esri/core/tsSupport/declareExtendsHelper","esri/core/tsSupport/decorateHelper","esri/core/tsSupport/assignHelper","../context/Context","../aiim/base/ItemReference","../context/Topic","esri/core/accessorSupport/decorators","esri/widgets/support/widget","esri/widgets/Widget"],function(t,e,o,n,i,r,l,s,c,a,f){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var u="i-levelfilter",d="i-levelfilter-list",v="i-button i-button-listitem",h="i-button i-button-listitem i--active",p="i-button i-button-listitem i-button--clear",y="i-button i-button-listitem i-button--up",w="i-button i-button-listitem i-button--down",b="i-button i-button-listitem i-button--info",I=function(i){function t(t){var e=i.call(this,t)||this;return e._outOfSync=!1,e}return o(t,i),t.prototype.postInitialize=function(){var o=this;this.own(s.default.subscribe(s.default.FacilityDeactivated,function(t){try{if(o.view!==t.view)return o._outOfSync=!0,void(o.facilityInfo=null);o.facilityInfo=null}catch(t){console.error(t)}})),this.own(s.default.subscribe(s.default.FacilityActivated,function(t){try{if(o.view!==t.view)return o._outOfSync=!0,void(o.facilityInfo=null);var e=r.default.getInstance().aiim.datasets.facilities,i=r.default.getInstance().aiim.datasets.levels;e&&i&&(o._considerScrollIntoView=!0,o.facilityInfo=t.facilityInfo)}catch(t){console.error(t)}})),this.own(s.default.subscribe(s.default.FacilityModeUpdated,function(t){try{if(o.view!==t.view)return o._outOfSync=!0,void(o.facilityInfo=null)}catch(t){console.error(t)}})),this.own(s.default.subscribe(s.default.ViewActivated0,function(t){o.view&&o.view===t.view&&(o._outOfSync&&(o._outOfSync=!1,r.default.getInstance().aiim.facilityMode.applyActiveFacilityInfo(o.view)))}))},t.prototype.afterUpdate=function(t){this._considerScrollIntoView&&(this._considerScrollIntoView=!1,this._scrollIntoView(t))},t.prototype.render=function(){var t=this.renderLevels();return t?a.tsx("div",{class:u,style:"display:block;",bind:this,afterUpdate:this.afterUpdate},this.renderExit(),t,this.renderInfo()):a.tsx("div",{style:"display:none;",bind:this,afterUpdate:this.afterUpdate})},t.prototype.renderAll=function(){var t=this,e=r.default.getInstance().i18n.levelFilter.all,i=v;this.facilityInfo&&this.facilityInfo.activeLevel||(i=h);return a.tsx("button",{key:"k_all",type:"button",class:i,onclick:function(){s.default.publish(s.default.LevelSelected,{facilityId:t.facilityInfo.facilityId,view:t.view})}},e)},t.prototype.renderExit=function(){var t=this,e=r.default.getInstance().i18n.levelFilter.exit,i=a.tsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 16"},a.tsx("path",{d:"M8 .15A7.85 7.85 0 1 0 15.85 8 7.85 7.85 0 0 0 8 .15zm4.95 11.386l-1.414 1.414L8 9.414 4.464 12.95 3.05 11.536 6.586 8 3.05 4.464 4.464 3.05 8 6.586l3.536-3.536 1.414 1.414L9.414 8z"}));return a.tsx("button",{key:"k_exit",type:"button",class:p,onclick:function(){s.default.publish(s.default.DeactivateFacilityClicked,{facilityInfo:t.facilityInfo,view:t.view})},title:e},i)},t.prototype.renderInfo=function(){var n=this,t=r.default.getInstance().i18n.levelFilter.facilityInfo,e=a.tsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"32",height:"32",viewBox:"0 0 32 32",class:"svg-icon"},a.tsx("path",{d:"M31.297 16.047c0 8.428-6.826 15.25-15.25 15.25S.797 24.475.797 16.047c0-8.424 6.826-15.25 15.25-15.25s15.25 6.826 15.25 15.25zM18 24V12h-4v12h-2v2h8v-2h-2zm0-18h-4v4h4V6z"}));return this.facilityInfo.facilitiesSource?a.tsx("button",{key:"k_info",type:"button",class:b,onclick:function(){var e=n.facilityInfo.facilityId,t=n.facilityInfo.facilitiesSource,i={sourceKey:t.key,uniqueIdField:t.uniqueIdField,uniqueId:e},o=new l.default;o.fromJson(i).then(function(t){t&&o.searchResult?s.default.publish(s.default.ShowSearchResult,{sourceKey:o.sourceKey,searchResult:o.searchResult,zoom:!1,highlight:!0,trackRecent:!0,publishedFromLevelFilter:!0}):console.warn("The facility item is invalid: ",e)}).catch(function(t){console.error("Error opening facility:",t)})},title:t},e):null},t.prototype.renderLevel=function(t,e){var i=this,o=t.levelShortName,n="k_"+e,l=v,r=this.facilityInfo&&this.facilityInfo.activeLevel;!r&&this.view&&"2d"===this.view.type&&(r=this.facilityInfo&&this.facilityInfo.zeroVOLevel),r===t&&(l=h);return 0===e&&(l+=" i--first"),a.tsx("li",{key:n},a.tsx("button",{type:"button",class:l,onclick:function(){s.default.publish(s.default.LevelSelected,{facilityId:i.facilityInfo.facilityId,levelData:t,view:i.view})}},o))},t.prototype.renderLevels=function(){var i=this,o=0;if(this.facilityInfo&&this.facilityInfo.levels&&0<this.facilityInfo.levels.length){r.default.getInstance().i18n;var t=this.facilityInfo.levels.map(function(t,e){return i.renderLevel(t,e)});if(t&&1<t.length&&(t=t.slice().reverse()),t){var e=null;1<t.length&&this.view&&"3d"===this.view.type&&(e=this.renderAll());var n=null,l=null;return!r.default.getInstance().uiMode.isTouch&&3<t.length&&(n=a.tsx("button",{key:"k_up",type:"button",class:y,onclick:function(){var t=i._ulNode;if(t&&1<o){var e=t.scrollHeight/o;t.scrollTop=t.scrollTop-e}}},a.tsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"32",height:"32",viewBox:"0 0 32 32",class:"svg-icon"},a.tsx("path",{d:"M2 24l14-14 14 14H2z"}))),l=a.tsx("button",{key:"k_dn",type:"button",class:w,onclick:function(){var t=i._ulNode;if(t&&1<o){var e=t.scrollHeight/o;t.scrollTop=t.scrollTop+e}}},a.tsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"32",height:"32",viewBox:"0 0 32 32",class:"svg-icon"},a.tsx("path",{d:"M30 10L16 24 2 10h28z"})))),o=t.length,a.tsx("div",{key:"levels"},n,a.tsx("ul",{class:d,bind:this,"data-node-ref":"_ulNode",afterCreate:a.storeNode},t),l,e)}}return null},t.prototype._scrollIntoView=function(t){var e=t.querySelector("li > .i--active");e||(e=t.querySelector("li > .i--first")),e&&e.scrollIntoView({block:"end",behavior:"smooth"})},n([c.property()],t.prototype,"facilityInfo",void 0),n([c.property()],t.prototype,"view",void 0),t=n([c.subclass("app.map.LevelFilter")],t)}(c.declared(f));e.default=I});