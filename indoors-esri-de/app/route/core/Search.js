var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,s){e.__proto__=s}||function(e,s){for(var t in s)s.hasOwnProperty(t)&&(e[t]=s[t])};return function(e,s){function t(){this.constructor=e}n(e,s),e.prototype=null===s?Object.create(s):(t.prototype=s.prototype,new t)}}(),__decorate=this&&this.__decorate||function(e,s,t,n){var r,i=arguments.length,o=i<3?s:null===n?n=Object.getOwnPropertyDescriptor(s,t):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,s,t,n);else for(var a=e.length-1;0<=a;a--)(r=e[a])&&(o=(i<3?r(o):3<i?r(s,t,o):r(s,t))||o);return 3<i&&o&&Object.defineProperty(s,t,o),o};define(["require","exports","esri/core/tsSupport/declareExtendsHelper","esri/core/tsSupport/decorateHelper","esri/core/tsSupport/assignHelper","../../context/Context","esri/widgets/Search","esri/core/accessorSupport/decorators","esri/widgets/support/widget","dojo/i18n!esri/widgets/Search/nls/Search","dojo/i18n!esri/nls/common","esri/core/lang","esri/widgets/Search/SearchViewModel","dojo/keys"],function(e,s,n,r,t,h,i,o,F,H,V,Y,U,a){"use strict";Object.defineProperty(s,"__esModule",{value:!0});var X="esri-search esri-widget",q="esri-widget__loader",z="esri-widget__loader-text",G="esri-widget__loader-animation",J="esri-input",Q="esri-search--multiple-sources",W="esri-search--loading",Z="esri-search--searching",$="esri-search--show-suggestions",ee="esri-search--sources",se="esri-search--warning",te="esri-search__container",ne="esri-search__input",re="esri-search__input-container",ie="esri-search__form",oe="esri-search__submit-button",ae="esri-search__sources-button",ce="esri-search__clear-button",le="esri-search__source-name",ue="esri-search__suggestions-menu",de="esri-search__suggestions-list",c="esri-search__suggestions-list--current-location",he="esri-search__sources-menu",pe="esri-search__warning-menu",_e="esri-search__warning-body",ge="esri-search__warning-header",fe="esri-search__warning-text",xe="esri-search__no-value-text",ye="esri-widget--button",be="esri-icon-font-fallback-text",l="esri-icon-locate-circled",me="esri-menu",ke="esri-icon-search",ve="esri-icon-down-arrow esri-search__sources-button--down",we="esri-icon-up-arrow esri-search__sources-button--up",Se="esri-icon-close",Ie="esri-icon-notice-triangle",Ce="esri-disabled",u="i-feature-item",d="i-feature-item-icon",p="i-feature-item-text",_="i-feature-item-title",g="i-feature-item-subtitle",f="home-16-f",x="star-16-f",y="pin-16-f",b=function(t){function e(e){var s=t.call(this)||this;return s.indoorsDirections=null,s.xtn__handleInputKeyup=(new i)._handleInputKeyup,s.indoorsInit(),s}return n(e,t),e.prototype._handleInputKeyup=function(e){this.xtn__handleInputKeyup.call(this,e),e.keyCode===a.BACKSPACE&&"string"==typeof this.searchTerm&&0===this.searchTerm.length&&"suggestion"!==this.activeMenu&&(this.activeMenu="suggestion")},e.prototype.render=function(){var e,s,o=this,t=this.viewModel,n=t.activeSourceIndex,r=t.suggestions,i=t.maxInputLength,a=t.placeholder,c=t.searchTerm,l=t.searchAllEnabled,u=t.allSources,d=this._getSourceName(n),h=(""+c).trim(),p=this.activeMenu,_=this.id,g=this.viewModel.state,f=this.id+"-suggest-menu",x=F.tsx("input",{bind:this,placeholder:a,"aria-label":H.searchButtonTitle,maxlength:i,autocomplete:"off",type:"text",tabindex:"0",class:this.classes(J,ne),"aria-autocomplete":"list",value:c,"aria-haspopup":"true","aria-owns":f,role:"textbox",onkeydown:this._handleInputKeydown,onkeyup:this._handleInputKeyup,onclick:this._handleInputClick,oninput:this._handleInputPaste,onpaste:this._handleInputPaste,afterCreate:F.storeNode,"data-node-ref":"_inputNode",onfocusout:this._storeRelatedTarget,onfocus:this.focus,onblur:this.blur,title:c?"":a}),y=F.tsx("form",{key:"esri-search__form",bind:this,class:ie,onsubmit:this._formSubmit,role:"search"},x),b=c?F.tsx("div",{key:"esri-search__clear-button",bind:this,role:"button",class:this.classes(ce,ye),tabindex:"0",title:H.clearButtonTitle,onfocus:this._clearButtonFocus,onclick:this._handleClearButtonClick,onkeydown:this._handleClearButtonClick},F.tsx("span",{"aria-hidden":"true",class:Se})):null,m=this.indoorsRenderLocationSuggest(),k=1<u.length&&n===U.ALL_INDEX,v=r?r.map(function(e,s){var t=e.sourceIndex,n=e.results.length,r=n&&k?o._getSuggestionHeaderNode(t):null,i=e.results.map(function(e,s){return o._getSuggestionNode(e,s,t)});return[r,n?F.tsx("ul",{key:"esri-search__suggestion-list-"+t,class:de},i):null]}):null,w=F.tsx("div",{id:f,"aria-expanded":"suggestion"===p,key:"esri-search__suggestions-menu",class:this.classes(me,ue),role:"menu",bind:this,afterCreate:F.storeNode,"data-node-ref":"_suggestionListNode"},m,v),S=F.tsx("div",{key:"esri-search__input-container",class:re},y,w,b),I=F.tsx("div",{key:"esri-search__submit-button",bind:this,role:"button",title:H.searchButtonTitle,class:this.classes(oe,ye),tabindex:"0",onclick:this._handleSearchButtonClick,onkeydown:this._handleSearchButtonClick},F.tsx("span",{"aria-hidden":"true",role:"presentation",class:ke}),F.tsx("span",{class:be},H.searchButtonTitle)),C=h?Y.substitute({value:'"'+c+'"'},H.noResultsFoundForValue):H.noResultsFound,P=t.get("selectedSuggestion.location")||h?F.tsx("div",{key:"esri-search__no_results"},F.tsx("div",{class:ge},H.noResults),F.tsx("div",{class:fe},C)):null,R=t.get("selectedSuggestion.location")||h?null:F.tsx("div",{key:"esri-search__empty-search"},F.tsx("span",{"aria-hidden":"true",class:Ie}),F.tsx("span",{class:xe},H.emptyValue)),B=F.tsx("div",{key:"esri-search__error-menu",class:this.classes(me,pe)},F.tsx("div",{class:_e},P,R)),N=1<u.length,T=u&&u.toArray(),L=l?this._getSourceNode(U.ALL_INDEX):null,K=_+"-source-menu",M=N?F.tsx("div",{key:"esri-search__source-menu-button",bind:this,role:"button",title:H.searchIn,"aria-haspopup":"true","aria-expanded":"source"===p,"aria-controls":K,class:this.classes(ae,ye),tabindex:"0",onkeydown:this._handleSourceMenuButtonKeydown,onclick:this._handleSourcesMenuToggleClick,onkeyup:this._handleSourceMenuButtonKeyup,onblur:this._sourcesButtonBlur,afterCreate:F.storeNode,"data-node-ref":"_sourceMenuButtonNode"},F.tsx("span",{"aria-hidden":"true",role:"presentation",class:ve}),F.tsx("span",{"aria-hidden":"true",role:"presentation",class:we}),F.tsx("span",{class:le},d)):null,D=N?F.tsx("ul",{bind:this,afterCreate:F.storeNode,"data-node-ref":"_sourceListNode"},L,T.map(function(e,s){return o._getSourceNode(s)})):null,j=F.tsx("div",{id:K,key:"esri-search__source-menu",class:this.classes(me,he),role:"menu"},D),E=((e={})[Q]=N,e[W]="loading"===g,e[Z]="searching"===g,e[se]="warning"===p,e[ee]="source"===p,e[$]="suggestion"===p,e),O=((s={})[Ce]="disabled"===g,s),A="loading"===g?F.tsx("div",{role:"presentation",class:q,key:"base-loader"},F.tsx("span",{"aria-hidden":"true",role:"presentation",class:G}),F.tsx("span",{class:be},H.searchButtonTitle),F.tsx("span",{class:z},V.loading)):F.tsx("div",{role:"presentation",class:this.classes(E,te),key:"base-container"},M,j,S,I,B);return F.tsx("div",{class:this.classes(X,O)},A)},e.prototype.indoorsInit=function(){},e.prototype.indoorsRenderLocationSuggest=function(){var e=this.indoorsRenderPlaces(),s=(""+this.viewModel.searchTerm).trim(),t=this.locationEnabled&&!s?F.tsx("ul",{key:"esri-search__suggestion-list-current-location",class:this.classes(de,c)},F.tsx("li",{bind:this,onclick:this._handleUseCurrentLocationClick,onkeydown:this._handleUseCurrentLocationClick,onkeyup:this._handleSuggestionKeyup,role:"menuitem",tabindex:"-1"},F.tsx("span",{"aria-hidden":"true",role:"presentation",class:l})," ",H.useCurrentLocation),e):null;return!e||t||s||(t=F.tsx("ul",{key:"esri-search__suggestion-list-current-location",class:this.classes(de,c)},e)),t},e.prototype.indoorsRenderIcon=function(e){var s="libs/calcite-ui-icons/icons/sprite-16.svg#"+e;return F.tsx("svg",{class:d},F.tsx("use",{href:s}))},e.prototype.indoorsRenderPlace=function(s,e,t,n,r){var i=this,o=this.indoorsRenderIcon(t);return F.tsx("li",{key:e,onmousedown:function(e){e&&e.target&&"LI"===e.target.tagName&&(i._focus("none"),i.indoorsDirections&&"function"==typeof i.indoorsDirections.indoorsYourPlaceSelected&&i.indoorsDirections.indoorsYourPlaceSelected(s))}},F.tsx("a",{href:"#",class:u,bind:this,onclick:function(){i._focus("none"),i.indoorsDirections&&"function"==typeof i.indoorsDirections.indoorsYourPlaceSelected&&i.indoorsDirections.indoorsYourPlaceSelected(s)},onkeyup:this._handleSuggestionKeyup,tabindex:"0"},o,F.tsx("span",{class:p},F.tsx("span",{class:_},n),F.tsx("span",{class:g},r))))},e.prototype.indoorsRenderPlaces=function(){var t,e,n,s,r,i,o,a=this,c=[],l=h.default.getInstance().i18n,u=h.default.getInstance().isKiosk,d=h.default.getInstance().session.referenceLayer;return d.hasItems()?((e=d.homeLocation).isValid()&&(n="i-place-home",t=f,o=l.yourPlaces.home,i=e.getTitle(),(r=this.indoorsRenderPlace(e,n,t,o,i))&&c.push(r)),t=x,(s=d.favorites)&&0<s.length&&s.forEach(function(e,s){n="i-place-favorite-"+s,o=e.getTitle(),i=e.getSubTitle(),(r=a.indoorsRenderPlace(e,n,t,o,i))&&c.push(r)}),t=y,s=d.recent,!u&&s&&0<s.length&&s.forEach(function(e,s){n="i-place-recent-"+s,o=e.getTitle(),i=e.getSubTitle(),(r=a.indoorsRenderPlace(e,n,t,o,i))&&c.push(r)}),0<c.length?c:null):null},e=r([o.subclass("app.route.core.Search")],e)}(o.declared(i));s.default=b});