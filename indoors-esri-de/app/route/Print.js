var __extends=this&&this.__extends||function(){var i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}}(),__decorate=this&&this.__decorate||function(e,t,r,i){var o,n=arguments.length,a=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,i);else for(var s=e.length-1;0<=s;s--)(o=e[s])&&(a=(n<3?o(a):3<n?o(t,r,a):o(t,r))||a);return 3<n&&a&&Object.defineProperty(t,r,a),a};define(["require","exports","esri/core/tsSupport/declareExtendsHelper","esri/core/tsSupport/decorateHelper","esri/core/tsSupport/assignHelper","../context/Context","./Util","esri/core/Accessor","esri/core/accessorSupport/decorators","esri/tasks/PrintTask","esri/tasks/support/PrintTemplate","esri/tasks/support/PrintParameters","esri/Graphic","esri/symbols/SimpleMarkerSymbol","dojo/_base/window","dojo/dom","dojo/dom-class","dojo/dom-construct","dojo/dom-geometry","dojo/number"],function(e,t,i,o,r,d,n,a,s,c,u,h,y,m,g,w,v,b,f,T){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var x="i-print-window",S="i-print-window-no-print",L="i-print-window-content",M="i-print-window-actions i-print-window-no-print",H="btn",P="i-print-window-title",_="i-print-window-map i-print-window-wait",O="i-print-window-mapimage",k="i-print-window-wait",I="i-print-window-failed",R="i-print-window-page-break",E="i-print-window-notes i-print-window-no-screen",D="i-print-window-notes-area i-print-window-no-print",l="i-print-window-directions",j="i-print-window-directions-row",N="i-print-window-directions-row-event",C="",G="i-print-window-row-icon",J="",W="",z="i-print-window-row-info",A="i-print-window-row-text",q="i-print-window-row-length",p="i-print-window-cost-summary",U="i-brand-logo-print",V=function(r){function e(e){var t=r.call(this,e)||this;return t.updateDelay=1e3,t.sizeInfo={dpi:384,mapWidth:3200,mapHeight:1600,pageWidth:"800px",pageHeight:"400px"},t.util=new n.default,t}return i(e,r),e.prototype.boldText=function(e,t){var r=e;try{var i=new RegExp("[^<strong>&nbsp;]"+t.replace(/(\||\$|\^|\(|\)|\[|\]|\{|\}|\/|\.|\+|\*|\?|\?)/g,"\\$1")+"[^&nbsp;</strong>]","g");r=(r=(" "+r+" ").replace(i,"<strong>&nbsp;"+t+"&nbsp;</strong>")).trim()}catch(e){}return r},e.prototype.createPrintTask=function(){var e=this.getPrintTaskUrl(),d=new c({url:e,updateDelay:this.updateDelay}),u=d._createFeatureCollectionJSON;return d._createFeatureCollectionJSON=function(e,t,r){if(!t&&e&&"esri.layers.GraphicsLayer"===e.declaredClass&&"graphics"===e.type){var i=[];if("indoorsRouteGraphicsLayer"===e.title||"indoorsHighlightGraphicsLayer"===e.title||"indoorsStopGraphicsLayer"===e.title||"indoorsLocationGraphics"===e.title){var o=e.graphics.items;if(o&&0<o.length)for(var n=0;n<o.length;n++){var a=o[n]||o.getItemAt(n);if(a&&a.geometry){var s=a.toJSON();if(s&&s.geometry){s.geometry.hasZ=!1,delete s.geometry.z;if(!s.symbol||"point"!==a.geometry.type&&"polygon"!==a.geometry.type||"indoorsStopGraphicsLayer"!==e.title||"image/svg+xml"!==s.symbol.contentType)(!s.symbol||"point"!==a.geometry.type&&"polygon"!==a.geometry.type||"indoorsLocationGraphics"!==e.title||"image/svg+xml"!==s.symbol.contentType)&&i.push(y.fromJSON(s));else{var c=new m({style:"circle",size:19,color:[255,255,255,1],outline:{color:[51,51,51,1],width:3}});c&&(s.symbol=c.toJSON()),i.push(y.fromJSON(s));var l=new m({style:"square",size:7,color:[20,20,20,1],outline:null});if(l){var p=a.toJSON();p.geometry.hasZ=!1,delete p.geometry.z,p.symbol=l.toJSON(),i.push(y.fromJSON(p))}}}}}}if(i&&0<i.length)return u.call(d,{},i,r)}return u.call(d,e,t,r)},d},e.prototype.getLetter=function(e){return""},e.prototype.getPrintTaskUrl=function(){var e=null;try{var t=d.default.getInstance().portal;t&&t.helperServices&&t.helperServices.printTask&&(e=t.helperServices.printTask.url),"string"==typeof e&&0<e.length&&(e=d.default.checkMixedContent(e))}catch(e){console.warn("Error getting PrintTask url:"),console.error(e)}return e},e.prototype.getRouteName=function(){if(this.routeResult){var e=this.routeResult.routeName;if("string"==typeof e&&0<e.length)return e}return null},e.prototype.loadPrintWindow=function(e,t){var r=d.default.getInstance().i18n,i=this.getRouteName(),o=i||"",n="ltr";f.isBodyLtr()||(n="rtl");var a="";a+="<!DOCTYPE HTML>",a+="<html dir='"+n+"'>",a+="<head>",a+="<meta charset='utf-8'>",a+="<meta http-equiv='X-UA-Compatible' content='IE=Edge,chrome=1'>",a+="<meta http-equiv='Cache-Control' content='no-cache, no-store, must-revalidate' />",a+="<meta http-equiv='Pragma' content='no-cache' />",a+="<meta http-equiv='Expires' content='0' />",a+="<title>"+o+"</title>",a+="<link rel='stylesheet' media='screen' type='text/css' href='./app/style/css/directions-screen.css' />",a+="<link rel='stylesheet' media='print' type='text/css' href='./app/style/css/directions-print.css' />",a+="</head>",a+="<body class='"+x+"'>",a+="</body>",a+="</html>",e.document.open("text/html","replace"),e.document.write(a),e.document.close();var s=b.create("div",{class:L},e.document.body,"last"),c=H,l=d.default.getInstance().uiMode;l.isTouch&&(l.modeIsHorizontalSplit()||l.modeIsVerticalSplit())&&(c+=" i-large");var p=b.create("div",{class:M},s,"last");b.create("button",{class:c,innerHTML:r.general.print,onclick:"window.print();"},p,"last"),b.create("button",{class:c,innerHTML:r.general.close,onclick:"window.close();"},p,"last"),this.renderLogo(e,s),b.create("div",{class:P,innerHTML:o},s,"last"),this.renderSummary(e,s),t&&(b.create("div",{class:_,id:"divMap"},s,"last"),b.create("hr",{class:S},s,"last")),b.create("div",{class:E,id:"print-notes"},s,"last"),b.create("textarea",{class:D,id:"print-notes-area",onchange:"document.getElementById('print-notes').innerHTML=this.value;",placeholder:r.directions.printWindow.notes},s,"last"),this.renderDirections(e,s)},e.prototype.print=function(){var i=d.default.getInstance().i18n,e=d.default.getInstance().views.activeView,t=this.createPrintTask(),o=this.sizeInfo,r=(new u).set({attributionVisible:!1,preserveScale:!1,showLabels:!0,format:"png32",layout:"map-only",exportOptions:{width:o.mapWidth,height:o.mapHeight,dpi:o.dpi},layoutOptions:{titleText:"Building Floorplan",authorText:"ArcGIS Indoors"}}),n=new h({view:e,outSpatialReference:e.spatialReference,template:r}),a=screen.width/2,s=screen.height/1.5,c=screen.width/2-a/2,l="toolbar=no,location=no,directories=no,status=yes,menubar=no,scrollbars=yes,resizable=yes";l+=",width="+a+",height="+s+",top="+(screen.height/2-s/2)+",left="+c;var p=window.open("","indoors_print_directions",l,!0);this.loadPrintWindow(p,!0),t.execute(n).then(function(r){g.withDoc(p.document,function(){var e=w.byId("divMap");if(e){var t="width:"+o.pageWidth+";height:"+o.pageHeight+";";v.remove(e,k),v.add(e,R),b.create("img",{src:r.url,class:O,style:t,alt:i.directions.printWindow.mapAltText},e)}})}).catch(function(e){console.warn("Error creating print:"),console.error(e),g.withDoc(p.document,function(){var e=w.byId("divMap");e&&(v.remove(e,k),v.add(e,I),e.innerHTML=i.directions.printWindow.failed)})})},e.prototype.renderDirections=function(r,e){var i=this;if(this.routeResult){var t=this.routeResult.sections;if(t&&0<t.length){var o=b.create("table",{class:l},e,"last"),n=b.create("tbody",{},o,"last"),a=0;t.forEach(function(t){t.steps.forEach(function(e){e.isEvent||a++,i.renderStep(r,n,t,e,a)})})}}},e.prototype.renderLogo=function(e,t){var r=d.default.getInstance().uiMode.getLogoUrl(),i=window.getComputedStyle(document.documentElement,null),o=i.getPropertyValue("--i-logo-print-width"),n=i.getPropertyValue("--i-logo-print-height"),a="clear: both; display: block;";"string"==typeof o&&0<o.trim().length&&(a+=" width: "+o.trim()+";"),"string"==typeof n&&0<n.trim().length&&(a+=" height: "+n.trim()+";"),"string"==typeof r&&0<r.length&&b.create("img",{src:r,style:a,class:U},t,"last")},e.prototype.renderStep=function(e,t,r,i,o){var n=j;i.isEvent&&(n=N);var a=b.create("tr",{class:n,"data-segment":o,"tab-index":"0",role:"menuitem"},t,"last"),s=b.create("td",{class:C},a,"last"),c=i.maneuverIconUrl;c&&b.create("img",{class:G,src:c},s,"last");var l="";i.isEvent||(l=T.format(o)+". ");var p=b.create("td",{class:J},a,"last");b.create("strong",{innerHTML:l},p,"last");var d=b.create("td",{class:W},a,"last"),u=b.create("div",{class:z,innerHTML:this.getLetter(null)},d,"last"),h=i.text,y=b.create("div",{class:A},u,"last");b.create("span",{innerHTML:h},y,"last");var m=!1;if(!i.isEvent){var g=i.maneuverType;g&&"esriDPTManeuverArrive"!==g&&"esriDPTManeuverDepart"!==g&&(m=!0)}if(m){var w=r.distanceText;if(w){var v=b.create("div",{class:q},u,"last");b.create("span",{innerHTML:w},v,"last");var f=r.timeText;f&&(b.create("span",{innerHTML:"&nbsp;&middot;<wbr>&nbsp;"},v,"last"),b.create("span",{innerHTML:f},v,"last"))}}},e.prototype.renderSummary=function(e,t){if(this.routeResult){var r=this.routeResult,i=r.totalDistanceText;if(i){var o=b.create("div",{class:p},t,"last");b.create("span",{innerHTML:i},o,"last");var n=r.totalTimeText;n&&(b.create("span",{innerHTML:"&nbsp;&middot;<wbr>&nbsp;"},o,"last"),b.create("span",{innerHTML:n},o,"last"))}}},o([s.property()],e.prototype,"directions",void 0),o([s.property()],e.prototype,"lastRoute",void 0),o([s.property()],e.prototype,"routeParameters",void 0),o([s.property()],e.prototype,"routeResult",void 0),o([s.property()],e.prototype,"serviceDescription",void 0),o([s.property()],e.prototype,"stops",void 0),o([s.property()],e.prototype,"updateDelay",void 0),e=o([s.subclass("app.route.Print")],e)}(s.declared(a));t.default=V});